<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Gask - Task Manager</title>
  <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700&family=Inter:wght@300;400;500;600&display=swap" rel="stylesheet">
  <style>
    :root {
      --primary-dark: #2c5d5a;
      --primary-medium: #7db3a8;
      --accent-light: #f5e6d3;
      --accent-warm: #e5c29f;
      --accent-coral: #d4a386;
      --white: #ffffff;
      --text-dark: #333333;
      --text-light: #666666;
      --background-light: #fafafa;
      --error: #e74c3c;
      --success: #27ae60;
      --font-heading: 'Orbitron', sans-serif;
      --font-body: 'Inter', sans-serif;
      --transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      --shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
      --shadow-hover: 0 8px 15px rgba(0, 0, 0, 0.15);
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: var(--font-body);
      background: linear-gradient(135deg, var(--background-light) 0%, var(--accent-light) 100%);
      color: var(--text-dark);
      line-height: 1.6;
      min-height: 100vh;
    }

    .container {
      max-width: 1200px;
      margin: 0 auto;
      padding: 20px;
    }

    h1 {
      font-family: var(--font-heading);
      color: var(--primary-dark);
      text-align: center;
      font-size: 3rem;
      margin-bottom: 2rem;
      text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.1);
    }

    .tabs {
      display: flex;
      justify-content: center;
      margin-bottom: 2rem;
      background: var(--white);
      border-radius: 12px;
      padding: 8px;
      box-shadow: var(--shadow);
    }

    .tab {
      padding: 12px 24px;
      background: transparent;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      font-weight: 500;
      transition: var(--transition);
      color: var(--text-light);
    }

    .tab.active {
      background: var(--primary-dark);
      color: var(--white);
      transform: translateY(-2px);
    }

    .tab:hover:not(.active) {
      background: var(--accent-light);
      color: var(--primary-dark);
    }

    .section {
      display: none;
      background: var(--white);
      border-radius: 16px;
      padding: 2rem;
      box-shadow: var(--shadow);
      margin-bottom: 2rem;
    }

    .section.active {
      display: block;
      animation: fadeIn 0.3s ease-in;
    }

    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(10px); }
      to { opacity: 1; transform: translateY(0); }
    }

    .section h2 {
      font-family: var(--font-heading);
      color: var(--primary-dark);
      margin-bottom: 1.5rem;
      font-size: 1.8rem;
    }

    .add-button {
      background: linear-gradient(135deg, var(--primary-dark), var(--primary-medium));
      color: var(--white);
      border: none;
      padding: 12px 24px;
      border-radius: 8px;
      cursor: pointer;
      font-weight: 600;
      transition: var(--transition);
      box-shadow: var(--shadow);
      margin-bottom: 1.5rem;
    }

    .add-button:hover {
      transform: translateY(-2px);
      box-shadow: var(--shadow-hover);
    }

    .item-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
      gap: 1.5rem;
    }

    .item-card {
      background: var(--accent-light);
      border: 2px solid transparent;
      padding: 1.5rem;
      border-radius: 12px;
      transition: var(--transition);
      position: relative;
      overflow: hidden;
    }

    .item-card:hover {
      border-color: var(--primary-medium);
      transform: translateY(-4px);
      box-shadow: var(--shadow-hover);
    }

    .item-card::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 4px;
      background: linear-gradient(90deg, var(--primary-dark), var(--accent-coral));
    }

    .item-title {
      font-weight: 600;
      color: var(--primary-dark);
      margin-bottom: 0.5rem;
      font-size: 1.1rem;
    }

    .item-description {
      color: var(--text-light);
      margin-bottom: 1rem;
      line-height: 1.5;
    }

    .item-meta {
      font-size: 0.9rem;
      color: var(--text-light);
      margin-bottom: 0.5rem;
    }

    .date-info {
      display: flex;
      justify-content: space-between;
      align-items: center;
      background: rgba(255, 255, 255, 0.7);
      padding: 8px 12px;
      border-radius: 6px;
      margin-top: 1rem;
    }

    .delete-button {
      background: var(--error);
      color: var(--white);
      border: none;
      padding: 6px 12px;
      border-radius: 4px;
      cursor: pointer;
      font-size: 0.8rem;
      transition: var(--transition);
      position: absolute;
      top: 10px;
      right: 10px;
      opacity: 0;
    }

    .item-card:hover .delete-button {
      opacity: 1;
    }

    .delete-button:hover {
      background: #c0392b;
      transform: scale(1.1);
    }

    .modal {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.5);
      z-index: 1000;
      backdrop-filter: blur(5px);
    }

    .modal.active {
      display: flex;
      justify-content: center;
      align-items: center;
      animation: fadeIn 0.3s ease-in;
    }

    .modal-content {
      background: var(--white);
      padding: 2rem;
      border-radius: 16px;
      box-shadow: var(--shadow-hover);
      max-width: 500px;
      width: 90%;
      max-height: 80vh;
      overflow-y: auto;
    }

    .form-group {
      margin-bottom: 1.5rem;
    }

    .form-group label {
      display: block;
      margin-bottom: 0.5rem;
      font-weight: 500;
      color: var(--primary-dark);
    }

    .form-group input,
    .form-group textarea {
      width: 100%;
      padding: 12px;
      border: 2px solid var(--accent-light);
      border-radius: 8px;
      font-family: inherit;
      transition: var(--transition);
    }

    .form-group input:focus,
    .form-group textarea:focus {
      outline: none;
      border-color: var(--primary-medium);
      box-shadow: 0 0 0 3px rgba(125, 179, 168, 0.1);
    }

    .form-group textarea {
      resize: vertical;
      min-height: 100px;
    }

    .form-buttons {
      display: flex;
      gap: 1rem;
      justify-content: flex-end;
    }

    .btn {
      padding: 10px 20px;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      font-weight: 500;
      transition: var(--transition);
    }

    .btn-primary {
      background: var(--primary-dark);
      color: var(--white);
    }

    .btn-primary:hover {
      background: var(--primary-medium);
    }

    .btn-secondary {
      background: var(--accent-warm);
      color: var(--text-dark);
    }

    .btn-secondary:hover {
      background: var(--accent-coral);
    }

    .status-message {
      padding: 12px;
      border-radius: 6px;
      margin-bottom: 1rem;
      font-weight: 500;
    }

    .status-error {
      background: #fdf2f2;
      color: var(--error);
      border: 1px solid #fecaca;
    }

    .status-success {
      background: #f0fff4;
      color: var(--success);
      border: 1px solid #a7f3d0;
    }

    .loading {
      text-align: center;
      color: var(--text-light);
      padding: 2rem;
    }

    .empty-state {
      text-align: center;
      color: var(--text-light);
      padding: 3rem;
      background: rgba(125, 179, 168, 0.05);
      border-radius: 12px;
      border: 2px dashed var(--accent-warm);
    }

    @media (max-width: 768px) {
      .container {
        padding: 10px;
      }

      h1 {
        font-size: 2rem;
      }

      .item-grid {
        grid-template-columns: 1fr;
      }

      .tabs {
        flex-wrap: wrap;
      }

      .modal-content {
        margin: 20px;
        width: calc(100% - 40px);
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>Gask</h1>
    
    <div class="tabs">
      <button class="tab active" onclick="switchTab('tasks')">Tasks</button>
      <button class="tab" onclick="switchTab('notes')">Notes</button>
      <button class="tab" onclick="switchTab('boxes')">Boxes</button>
    </div>

    <section id="tasks-section" class="section active">
      <h2>Tasks</h2>
      <button class="add-button" onclick="openTaskModal()">Add Task</button>
      <div id="status-tasks"></div>
      <div id="task-list" class="item-grid"></div>
    </section>

    <section id="notes-section" class="section">
      <h2>Notes</h2>
      <button class="add-button" onclick="openNoteModal()">Add Note</button>
      <div id="status-notes"></div>
      <div id="note-list" class="item-grid"></div>
    </section>

    <section id="boxes-section" class="section">
      <h2>Boxes</h2>
      <button class="add-button" onclick="openBoxModal()">Add Box</button>
      <div id="status-boxes"></div>
      <div id="box-list" class="item-grid"></div>
    </section>
  </div>

  <!-- Task Modal -->
  <div id="task-modal" class="modal">
    <div class="modal-content">
      <h3>Add New Task</h3>
      <form id="task-form">
        <div class="form-group">
          <label for="task-description">Description</label>
          <textarea id="task-description"></textarea>
        </div>
        <div class="form-group">
          <label for="task-due-date">Due Date</label>
          <input type="date" id="task-due-date">
        </div>
        <div class="form-group">
          <label for="task-shamsi-date">Shamsi Date (Optional)</label>
          <input type="text" id="task-shamsi-date" placeholder="YYYY-MM-DD">
        </div>
        <div class="form-buttons">
          <button type="button" class="btn btn-secondary" onclick="closeModal('task-modal')">Cancel</button>
          <button type="submit" class="btn btn-primary">Add Task</button>
        </div>
      </form>
    </div>
  </div>

  <!-- Note Modal -->
  <div id="note-modal" class="modal">
    <div class="modal-content">
      <h3>Add New Note</h3>
      <form id="note-form">
        <div class="form-group">
          <label for="note-title">Title*</label>
          <input type="text" id="note-title" required>
        </div>
        <div class="form-group">
          <label for="note-content">Content</label>
          <textarea id="note-content"></textarea>
        </div>
        <div class="form-buttons">
          <button type="button" class="btn btn-secondary" onclick="closeModal('note-modal')">Cancel</button>
          <button type="submit" class="btn btn-primary">Add Note</button>
        </div>
      </form>
    </div>
  </div>

  <!-- Box Modal -->
  <div id="box-modal" class="modal">
    <div class="modal-content">
      <h3>Add New Box</h3>
      <form id="box-form">
        <div class="form-group">
          <label for="box-name">Name*</label>
          <input type="text" id="box-name" required>
        </div>
        <div class="form-buttons">
          <button type="button" class="btn btn-secondary" onclick="closeModal('box-modal')">Cancel</button>
          <button type="submit" class="btn btn-primary">Add Box</button>
        </div>
      </form>
    </div>
  </div>

  <script>
    const API_URL = 'http://localhost:7887/api';
    const AUTH = btoa('admin:securepass');

    // State management
    let tasks = [];
    let notes = [];
    let boxes = [];

    // Utility functions
    function showStatus(elementId, message, isError = false) {
      const element = document.getElementById(elementId);
      element.innerHTML = `<div class="status-message ${isError ? 'status-error' : 'status-success'}">${message}</div>`;
      setTimeout(() => {
        element.innerHTML = '';
      }, 3000);
    }

    function showLoading(elementId) {
      const element = document.getElementById(elementId);
      element.innerHTML = '<div class="loading">Loading...</div>';
    }

    function showEmptyState(elementId, message) {
      const element = document.getElementById(elementId);
      element.innerHTML = `<div class="empty-state">${message}</div>`;
    }

    // API functions
    async function fetchWithAuth(url, options = {}) {
      try {
        options.headers = {
          ...options.headers,
          'Authorization': `Basic ${AUTH}`,
          'Content-Type': 'application/json',
        };
        const response = await fetch(url, options);
        if (!response.ok) {
          throw new Error(`HTTP ${response.status}: ${response.statusText}`);
        }
        return await response.json();
      } catch (error) {
        console.error('API Error:', error);
        throw error;
      }
    }

    // Shamsi date conversion (simplified)
    function toShamsi(date) {
      if (!date) return 'N/A';
      const d = new Date(date);
      // Simplified conversion - in production use proper library
      const shamsiYear = d.getFullYear() - 621;
      const shamsiMonth = d.getMonth() + 1;
      const shamsiDay = d.getDate();
      return `${shamsiYear}-${shamsiMonth.toString().padStart(2, '0')}-${shamsiDay.toString().padStart(2, '0')}`;
    }

    function formatDate(dateString) {
      if (!dateString) return 'N/A';
      const date = new Date(dateString);
      return date.toLocaleDateString('en-US', {
        year: 'numeric',
        month: 'short',
        day: 'numeric'
      });
    }

    // Tab switching
    function switchTab(tabName) {
      // Update tab buttons
      document.querySelectorAll('.tab').forEach(tab => tab.classList.remove('active'));
      document.querySelector(`button[onclick="switchTab('${tabName}')"]`).classList.add('active');

      // Update sections
      document.querySelectorAll('.section').forEach(section => section.classList.remove('active'));
      document.getElementById(`${tabName}-section`).classList.add('active');

      // Load data for active tab
      if (tabName === 'tasks') loadTasks();
      else if (tabName === 'notes') loadNotes();
      else if (tabName === 'boxes') loadBoxes();
    }

    // Modal functions
    function openTaskModal() {
      document.getElementById('task-modal').classList.add('active');
    }

    function openNoteModal() {
      document.getElementById('note-modal').classList.add('active');
    }

    function openBoxModal() {
      document.getElementById('box-modal').classList.add('active');
    }

    function closeModal(modalId) {
      document.getElementById(modalId).classList.remove('active');
      // Reset form
      const form = document.querySelector(`#${modalId} form`);
      if (form) form.reset();
    }

    // Close modal when clicking outside
    document.addEventListener('click', (e) => {
      if (e.target.classList.contains('modal')) {
        e.target.classList.remove('active');
      }
    });

    // Task functions
    async function loadTasks() {
      try {
        showLoading('task-list');
        tasks = await fetchWithAuth(`${API_URL}/tasks`);
        renderTasks();
      } catch (error) {
        showStatus('status-tasks', 'Failed to load tasks: ' + error.message, true);
        showEmptyState('task-list', 'Failed to load tasks');
      }
    }

    function renderTasks() {
      const list = document.getElementById('task-list');
      if (!tasks || tasks.length === 0) {
        showEmptyState('task-list', 'No tasks yet. Create your first task!');
        return;
      }

      list.innerHTML = tasks.map(task => `
        <div class="item-card">
          <button class="delete-button" onclick="deleteTask('${task.id}')">×</button>
          <div class="item-title">${escapeHtml(task.title)}</div>
          <div class="item-description">${escapeHtml(task.description || 'No description')}</div>
          <div class="date-info">
            <span>Due: ${formatDate(task.due_date)}</span>
            <span>Shamsi: ${toShamsi(task.due_date)}</span>
          </div>
        </div>
      `).join('');
    }

    async function createTask(e) {
      e.preventDefault();
      try {
        const formData = new FormData(e.target);
        const task = {
          title: document.getElementById('task-title').value,
          description: document.getElementById('task-description').value,
          due_date: document.getElementById('task-due-date').value || new Date().toISOString().split('T')[0]
        };

        if (!task.title.trim()) {
          throw new Error('Task title is required');
        }

        await fetchWithAuth(`${API_URL}/tasks`, {
          method: 'POST',
          body: JSON.stringify(task)
        });

        closeModal('task-modal');
        showStatus('status-tasks', 'Task created successfully!');
        loadTasks();
      } catch (error) {
        showStatus('status-tasks', 'Failed to create task: ' + error.message, true);
      }
    }

    async function deleteTask(id) {
      if (!confirm('Are you sure you want to delete this task?')) return;
      
      try {
        await fetchWithAuth(`${API_URL}/tasks/${id}`, {
          method: 'DELETE'
        });
        showStatus('status-tasks', 'Task deleted successfully!');
        loadTasks();
      } catch (error) {
        showStatus('status-tasks', 'Failed to delete task: ' + error.message, true);
      }
    }

    // Note functions
    async function loadNotes() {
      try {
        showLoading('note-list');
        notes = await fetchWithAuth(`${API_URL}/notes`);
        renderNotes();
      } catch (error) {
        showStatus('status-notes', 'Failed to load notes: ' + error.message, true);
        showEmptyState('note-list', 'Failed to load notes');
      }
    }

    function renderNotes() {
      const list = document.getElementById('note-list');
      if (!notes || notes.length === 0) {
        showEmptyState('note-list', 'No notes yet. Create your first note!');
        return;
      }

      list.innerHTML = notes.map(note => `
        <div class="item-card">
          <button class="delete-button" onclick="deleteNote('${note.id}')">×</button>
          <div class="item-title">${escapeHtml(note.title)}</div>
          <div class="item-description">${escapeHtml(note.content || 'No content')}</div>
          <div class="item-meta">Created: ${formatDate(note.created_date)}</div>
        </div>
      `).join('');
    }

    async function createNote(e) {
      e.preventDefault();
      try {
        const note = {
          title: document.getElementById('note-title').value,
          content: document.getElementById('note-content').value
        };

        if (!note.title.trim()) {
          throw new Error('Note title is required');
        }

        await fetchWithAuth(`${API_URL}/notes`, {
          method: 'POST',
          body: JSON.stringify(note)
        });

        closeModal('note-modal');
        showStatus('status-notes', 'Note created successfully!');
        loadNotes();
      } catch (error) {
        showStatus('status-notes', 'Failed to create note: ' + error.message, true);
      }
    }

    async function deleteNote(id) {
      if (!confirm('Are you sure you want to delete this note?')) return;
      
      try {
        await fetchWithAuth(`${API_URL}/notes/${id}`, {
          method: 'DELETE'
        });
        showStatus('status-notes', 'Note deleted successfully!');
        loadNotes();
      } catch (error) {
        showStatus('status-notes', 'Failed to delete note: ' + error.message, true);
      }
    }

    // Box functions
    async function loadBoxes() {
      try {
        showLoading('box-list');
        boxes = await fetchWithAuth(`${API_URL}/boxes`);
        renderBoxes();
      } catch (error) {
        showStatus('status-boxes', 'Failed to load boxes: ' + error.message, true);
        showEmptyState('box-list', 'Failed to load boxes');
      }
    }

    function renderBoxes() {
      const list = document.getElementById('box-list');
      if (!boxes || boxes.length === 0) {
        showEmptyState('box-list', 'No boxes yet. Create your first box!');
        return;
      }

      list.innerHTML = boxes.map(box => `
        <div class="item-card">
          <button class="delete-button" onclick="deleteBox('${box.id}')">×</button>
          <div class="item-title">${escapeHtml(box.name)}</div>
          <div class="item-meta">Tasks: ${box.tasks ? box.tasks.length : 0}</div>
        </div>
      `).join('');
    }

    async function createBox(e) {
      e.preventDefault();
      try {
        const box = {
          name: document.getElementById('box-name').value
        };

        if (!box.name.trim()) {
          throw new Error('Box name is required');
        }

        await fetchWithAuth(`${API_URL}/boxes`, {
          method: 'POST',
          body: JSON.stringify(box)
        });

        closeModal('box-modal');
        showStatus('status-boxes', 'Box created successfully!');
        loadBoxes();
      } catch (error) {
        showStatus('status-boxes', 'Failed to create box: ' + error.message, true);
      }
    }

    async function deleteBox(id) {
      if (!confirm('Are you sure you want to delete this box?')) return;
      
      try {
        await fetchWithAuth(`${API_URL}/boxes/${id}`, {
          method: 'DELETE'
        });
        showStatus('status-boxes', 'Box deleted successfully!');
        loadBoxes();
      } catch (error) {
        showStatus('status-boxes', 'Failed to delete box: ' + error.message, true);
      }
    }

    // Utility function to escape HTML
    function escapeHtml(text) {
      if (!text) return '';
      const div = document.createElement('div');
      div.textContent = text;
      return div.innerHTML;
    }

    // Form event listeners
    document.getElementById('task-form').addEventListener('submit', createTask);
    document.getElementById('note-form').addEventListener('submit', createNote);
    document.getElementById('box-form').addEventListener('submit', createBox);

    // Initialize app
    document.addEventListener('DOMContentLoaded', () => {
      loadTasks(); // Load initial data
    });

    // Test connection
    fetch(`http://localhost:7887/health`)
      .then(response => response.json())
      .then(data => console.log('Server connection:', data))
      .catch(error => {
        console.error('Server connection failed:', error);
        showStatus('status-tasks', 'Cannot connect to server. Make sure the backend is running on port 7887.', true);
      });
  </script>
</body>
</html>task-title">Title*</label>
          <input type="text" id="task-title" required>
        </div>
        <div class="form-group">
          <label for="
